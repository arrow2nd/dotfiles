# CLAUDE.md

このファイルは、Claudeとの対話を最適化するための設定とガイドラインを定義します。

## 🌐 言語設定

### 入力の解釈

- ユーザーはローマ字でテキストを入力することがあります
- ローマ字入力は適切な日本語として解釈してください
  - 例: `konnichiwa` → 「こんにちは」
  - 例: `arigatou` → 「ありがとう」

### 回答の言語

- **ユーザーは日本語話者です。対話には必ず日本語を使用してください**
- 不明確な質問の場合は、作業前に必ず確認を求めてください
  - 例: 「〜という理解で正しいでしょうか？」
  - 例: 「〜の部分をもう少し詳しく教えていただけますか？」

## 💻 コーディング規約

### コードスタイル

#### 1行のif文は使用禁止

単一行のif文は可読性が低いため、必ずブロック構文を使用してください。

❌ **NG例**

```js
if (isReturn) return;
if (error) throw new Error();
```

✅ **OK例**

```js
if (isReturn) {
  return;
}

if (error) {
  throw new Error();
}
```

#### TypeScriptの型定義

- `interface`が必須でない限り、`type`を優先して使用してください
- 理由:
  型エイリアスの方が柔軟性が高く、ユニオン型やインターセクション型との組み合わせが容易

```typescript
// ✅ 推奨
type User = {
  id: string;
  name: string;
};

// ❌ 非推奨（継承が必要な場合を除く）
interface User {
  id: string;
  name: string;
}
```

### テストコード作成の原則

- **実装の意図を理解してテストを書いてください**
- 固定値を返すことでテストをパスさせるような不正な実装は絶対に避けてください
- テストは実装の仕様を検証するものであり、テストに合わせて実装を歪めてはいけません

❌ **悪い例**

```js
// テストが `add(2, 3)` が 5 を返すことを期待している場合
function add(a, b) {
  return 5; // 固定値でテストをパス
}
```

✅ **良い例**

```js
function add(a, b) {
  return a + b; // 正しい実装
}
```

## 🛠️ シェル操作

### ファイル削除の安全性

- ファイルやディレクトリを削除する際は、`rm`コマンドの代わりに`trash`コマンドを使用してください
- これにより、誤削除した場合でも復元が可能です

```bash
# ❌ 使用しない
rm file.txt
rm -rf directory/

# ✅ 推奨
trash file.txt
trash directory/
```

## 音声合成機能 (VOICEVOX)

### 概要

vv-mcpサーバーを通じて、VOICEVOXの音声合成機能を利用できます。
作業の進捗報告や重要な通知を音声で伝えることができます。

### 設定情報

- **音声合成エンジン**: VOICEVOX
- **使用キャラクター**: ナースロボ＿タイプＴ
- **音声ID (voiceId)**: 47
- **デフォルト話速**: 1.0（範囲: 0.5〜2.0）

### 音声使用状況の確認

音声出力前に以下のツールで使用中の音声を確認してください：

1. **使用中音声の確認**: `mcp__vv-mcp__get_voices_in_use` で現在使用中の音声IDを取得
2. **空いている音声の取得**: `mcp__vv-mcp__get_random_unused_voice` で使用されていない音声を取得
3. **音声の選択**: デフォルト音声（ID: 47）が使用中の場合は、空いている音声を使用する

### 使用方法

```jsonc
// mcp__vv-mcp__sayツールの呼び出し例
{
  "text": "タスクが完了しました",
  "voiceId": 47,
  "speed": 1.0 // オプション（省略可能）
}
```

### 音声出力が必須の場面

以下の場面では**必ず音声で通知**してください：

1. **タスクの開始時**
   - 例: 「〜の作業を開始します」
2. **タスクの完了時**
   - 例: 「〜が完了しました」
3. **エラー発生時**
   - 例: 「エラーが発生しました。〜を確認してください」
4. **長時間処理の開始前**
   - 例: 「これから〜の処理を実行します。少々お待ちください」

### 使用制限

- vv-mcpは制限なくいつでも利用可能です
- 作業の進捗、発見、困っていること、考えていることなど、自由に発言してください

## lsmcp

### 概要

`typescript`という名前でlsmcp MCPサーバーが利用可能です。
TypeScriptプロジェクトでの編集作業において、Language
Server機能を最大限活用してください。

### 推奨実行フロー

#### 1. 初期探索段階

- `get_project_overview`: コードベース全体の理解
- `list_dir`: ディレクトリ構造の把握
- `get_symbols_overview`: シンボルの概要取得

#### 2. コード発見段階

- `search_symbols`: 関数、クラス、インターフェイスの検索（主要）
- `lsp_get_document_symbols`: 特定ファイル内のシンボル一覧
- `lsp_get_workspace_symbols`: ワークスペース全体のシンボル検索

#### 3. コード理解段階

- `get_symbol_details`: シンボルの詳細情報取得
- `lsp_get_definitions`: シンボルの定義箇所へジャンプ
- `lsp_find_references`: シンボルの使用箇所検索
- `lsp_get_hover`: 型情報の確認

#### 4. コード品質チェック

- `lsp_get_diagnostics`: エラーや警告の確認
- `lsp_get_code_actions`: 利用可能な修正アクションの取得

#### 5. コード修正段階

- `lsp_rename_symbol`: 安全なシンボルリネーム
- `lsp_format_document`: コードフォーマット
- `replace_range` / `replace_regex`: テキスト置換

### 具体的なワークフロー例

**新しいコードベースの調査**:

1. プロジェクト概要を取得
2. クラス構造を検索
3. シンボル詳細情報を取得

**バグ調査**:

1. 問題のある関数を発見
2. 実装内容を理解
3. 参照箇所を確認
4. 診断情報をレビュー

**リファクタリング**:

1. リファクタリング対象メソッドを発見
2. 現在の実装を理解
3. コードベース全体で安全にリネーム
4. フォーマットを整理

**新機能追加**:

1. プロジェクトアーキテクチャを理解
2. 関連インターフェイスを発見
3. インターフェイス詳細を取得
4. コーディング時に補完機能を活用

### フォールバックツール（控えめに使用）

- `Read`: 非コードファイル用
- `Grep`: テキストパターン検索
- `Glob`: ファイル検索
- `LS`: 基本的なディレクトリ一覧
- Bashコマンド: 非コード操作やトラブルシューティング
