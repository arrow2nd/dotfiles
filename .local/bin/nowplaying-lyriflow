#!/bin/bash

# 再生中のメタデータを取得
title=$(playerctl metadata -p spotify_player title 2>/dev/null)
artist=$(playerctl metadata -p spotify_player artist 2>/dev/null | cut -d',' -f1 | xargs)

if [ -z "$title" ] || [ -z "$artist" ]; then
    echo "Error: No track is currently playing"
    exit 1
fi

album=$(playerctl metadata -p spotify_player album 2>/dev/null)

# albumが取得できない場合は空文字列を使用
if [ -z "$album" ]; then
    album=""
fi

position=$(playerctl -p spotify_player position 2>/dev/null | awk '{print $1 + 1.0}')

# 歌詞を取得
lyriflow get --waybar --title "$title" --artist "$artist" --album "$album" --position "$position"

